import{s as S,e as x}from"./notify-BHQfjYk-.js";import{_ as V,h as w,a as c,b as r,e as s,w as n,f as q,k as T,o as a,F as b,y as g,l as f,q as h,t as C}from"./app-7HI8a4lx.js";import{a as B,E}from"./index-5YmKyRxA.js";import{a as D,E as R}from"./index-CHOIUUl7.js";import{E as N,a as U}from"./index-BPe1LNWi.js";import"./focus-trap-0JUCTGWq.js";import"./validator-CUeJqo3c.js";import"./index-Cexr__N_.js";import"./index-BRXl8bEV.js";import"./castArray-Dlxvef-B.js";import"./_baseClone-B9zh-0Fl.js";import"./index-BnH3xz_z.js";import"./_initCloneObject-BPdR5qB5.js";import"./index-4venPVpq.js";import"./isUndefined-DCTLXrZ8.js";import"./_baseIteratee-BTzwo4Hl.js";import"./index-uoaXWFBg.js";import"./isArrayLikeObject-BFgP_34p.js";import"./index-Cf7tx5Fe.js";import"./index-Bo03iq4n.js";const F={mixins:[w],data(){return{supportServersList:[{value:"MySQL",icon:"resources/icon/server/mysql_dark.svg"},{value:"MariaDB",icon:"resources/icon/server/mariadb.svg"},{value:"PostgreSQL",icon:"resources/icon/server/pgsql.svg"}],connections:[],source:{dbLoading:!1,dbList:[]},target:{dbLoading:!1,dbList:[]},option:{from:{connection:null,database:null,db:null},to:{db:null}},loading:{compare:!1,sync:!1},compareResult:{sqlList:null}}},computed:{remainHeight(){return window.outerHeight-340}},mounted(){this.on("nodes",t=>{this.connections=t}).on("sourceDB",t=>{this.source.dbList=t,this.source.dbLoading=!1}).on("targetDB",t=>{this.target.dbList=t,this.target.dbLoading=!1}).on("compareResult",t=>{this.compareResult=t,this.loading.compare=!1}).on("syncSuccess",()=>{S("syncSuccess"),this.loading.sync=!1}).on("success",()=>{this.refresh()}).on("error",t=>{x(t),this.loading.sync=!1}).init()},methods:{getIcon(t){for(const o of this.supportServersList)if(o.value==t)return o.icon;return"icon/server/mysql_dark.svg"},loadSource(t){this.emit("loadDB",{key:t}),this.source.dbLoading=!0,this.source.dbList=[],this.option.from.db=null,this.option.from.database=null},loadTarget(t){this.emit("loadDB",{key:t,isTarget:!0}),this.target.dbLoading=!0,this.target.dbList=[],this.option.to.db=null,this.option.to.database=null},changeActive(t,o){const v=o?this.source.dbList:this.target.dbList;for(const u of v)u.label==t&&(o?this.option.from.db=u:this.option.to.db=u);this.$forceUpdate()},startCompare(){this.loading.compare=!0,this.emit("start",this.option)},confrimSync(){const t=this.$refs.dataTable.getCheckboxRecords();if(!t||t.length==0){x("Need to select at least one sql!");return}this.loading.sync=!0,this.emit("sync",{sqlList:t,option:this.option})},selectionChange(t){this.toolbar.show=t.length>0},execute(t){t&&this.emit("execute",t)},refresh(){this.emit("init")}}},I=r("div",{style:{margin:"30px 20px"}}," Structure sync is being refactored and is currently unavailable ",-1),A={class:"opt-panel"},H=["src"],M={class:"opt-panel"},Q=["src"],j={key:0,class:"bg-secondBg pl-5 pt-3"},O={class:"mb-3"};function P(t,o,v,u,l,i){const d=N,m=U,p=E,y=B,L=T("vsc-button"),_=R,k=D;return a(),c("div",null,[I,r("div",A,[s(y,null,{default:n(()=>[s(p,{"label-width":"80px",label:"Target"},{default:n(()=>[s(m,{modelValue:l.option.from.connection,"onUpdate:modelValue":o[0]||(o[0]=e=>l.option.from.connection=e),filterable:"",onChange:i.loadSource},{default:n(()=>[(a(!0),c(b,null,g(l.connections,e=>(a(),f(d,{key:e.key,label:e.label,value:e.key},{default:n(()=>[r("img",{src:i.getIcon(e.dbType),class:"inline-block",style:{width:"13px",height:"13px",position:"relative",left:"-2px",top:"-1px"}},null,8,H),h(" "+C(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),s(p,{"label-width":"80px",label:"database"},{default:n(()=>[s(m,{modelValue:l.option.from.database,"onUpdate:modelValue":o[1]||(o[1]=e=>l.option.from.database=e),loading:l.source.dbLoading,filterable:"",onChange:o[2]||(o[2]=e=>i.changeActive(e,!0))},{default:n(()=>[(a(!0),c(b,null,g(l.source.dbList,e=>(a(),f(d,{key:e.label,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),r("div",M,[s(y,null,{default:n(()=>[s(p,{"label-width":"90px",label:"Sync From"},{default:n(()=>[s(m,{modelValue:l.option.to.connection,"onUpdate:modelValue":o[3]||(o[3]=e=>l.option.to.connection=e),filterable:"",onChange:i.loadTarget},{default:n(()=>[(a(!0),c(b,null,g(l.connections,e=>(a(),f(d,{key:e.key,label:e.label,value:e.key},{default:n(()=>[r("img",{src:i.getIcon(e.dbType),class:"inline-block",style:{width:"13px",height:"13px",position:"relative",left:"-2px",top:"-1px"}},null,8,Q),h(" "+C(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),s(p,{"label-width":"90px",label:"database"},{default:n(()=>[s(m,{modelValue:l.option.to.database,"onUpdate:modelValue":o[4]||(o[4]=e=>l.option.to.database=e),loading:l.target.dbLoading,filterable:"",onChange:o[5]||(o[5]=e=>i.changeActive(e,!1))},{default:n(()=>[(a(!0),c(b,null,g(l.target.dbList,e=>(a(),f(d,{key:e.label,label:e.label,value:e.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),s(L,{stlye:"margin-left:250px;",class:"m-2",loading:l.loading.compare,title:"Start Compare",onClick:i.startCompare},{default:n(()=>[h(" Compare ")]),_:1},8,["loading","onClick"]),r("div",null,[l.compareResult.sqlList?(a(),c("div",j,[r("div",O,[s(L,{loading:l.loading.sync,title:"Confrim Sync",onClick:i.confrimSync},{default:n(()=>[h(" Sync ")]),_:1},8,["loading","onClick"])]),s(k,{ref:"dataTable",data:l.compareResult.sqlList,height:i.remainHeight,style:{width:"100%"},onSelectionChange:i.selectionChange},{default:n(()=>[s(_,{type:"checkbox",width:"40",fixed:"left"}),s(_,{align:"center",width:"60",field:"type",label:"type"}),s(_,{align:"center",field:"sql",label:"sql"})]),_:1},8,["data","height","onSelectionChange"])])):q("",!0)])])}const de=V(F,[["render",P]]);export{de as default};
