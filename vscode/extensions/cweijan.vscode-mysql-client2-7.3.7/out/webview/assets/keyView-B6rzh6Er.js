import{_ as O,h as H,j as P,ab as U,a as g,b as y,e as n,w as a,J as D,l as c,f as u,t as v,C as K,D as R,k as S,o as r,q as k,F as A,y as J,I as F,z as Y,A as G}from"./app-7HI8a4lx.js";import{c as Z}from"./codemirror-Denn8pVo.js";import{s as q,e as C,n as j,c as V}from"./notify-BHQfjYk-.js";import{D as Q,s as W,p as X,d as $,E as ee}from"./DetailDialog-DfbD-1sp.js";import{a as te,E as ie}from"./index-BPe1LNWi.js";import{E as le}from"./index-Cexr__N_.js";import{a as ne,E as se}from"./index-5YmKyRxA.js";import{E as oe}from"./index-4venPVpq.js";import{E as ae}from"./index-D010uDlT.js";import{a as re,E as me}from"./index-CHOIUUl7.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./DatabaseType-ZbmIKB2x.js";import"./focus-trap-0JUCTGWq.js";import"./validator-CUeJqo3c.js";import"./index-BRXl8bEV.js";import"./index-BnH3xz_z.js";import"./index-Cf7tx5Fe.js";import"./index-Bo03iq4n.js";import"./_baseIteratee-BTzwo4Hl.js";import"./castArray-Dlxvef-B.js";import"./_baseClone-B9zh-0Fl.js";import"./_initCloneObject-BPdR5qB5.js";import"./isUndefined-DCTLXrZ8.js";import"./index-uoaXWFBg.js";import"./isArrayLikeObject-BFgP_34p.js";var z=(e=>(e.STRING="string",e.REJSON="ReJSON-RL",e.HASH="hash",e.LIST="list",e.ZSET="zset",e.SET="set",e.STREAM="stream",e))(z||{});const ue=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],de=["B","k","M","G","T","P","E","Z","Y"],ce=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],he=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],E=(e,t,s)=>{let d=e;return typeof t=="string"||Array.isArray(t)?d=e.toLocaleString(t,s):(t===!0||s!==void 0)&&(d=e.toLocaleString(void 0,s)),d};function ye(e,t){if(e==null||!Number.isFinite(e)&&(e=parseInt(e),!Number.isFinite(e)))return"";t={bits:!1,binary:!0,...t};const s=t.bits?t.binary?he:ce:t.binary?de:ue;if(t.signed&&e===0)return` 0 ${s[0]}`;const d=e<0,i=d?"-":t.signed?"+":"";d&&(e=-e);let o;if(t.minimumFractionDigits!==void 0&&(o={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(o={maximumFractionDigits:t.maximumFractionDigits,...o}),e<1){const m=E(e,t.locale,o);return i+m+" "+s[0]}const h=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),s.length-1);e/=(t.binary,1024**h),o||(e=e.toPrecision(3));const _=E(Number(e),t.locale,o),p=s[h];return`${i+_}${p}`}const pe={components:{codemirror:Z,DetailDialog:Q},mixins:[H],data(){return{cmContent:"",language:{current:"Text",supports:["Text","JSON","Yaml"],map:{Text:"text/plain",JSON:"application/json",Yaml:"text/yaml"}},itemModel:{old:null,key:null,score:null,value:null},searchInput:"",pageIndex:1,pageSize:100,dataCount:0,remainHeight:0,keyLoading:!0,isNew:!1,key:{name:"",ttl:-1,content:null,count:null,type:null},edit:{name:"",ttl:-1,content:null},itemDialogVisiable:!1,selectStyle:{float:this.float},textrows:6}},computed:{...P($,{itemDetail:e=>e.detail}),size(){var e;return((e=this.cmContent)==null?void 0:e.length)||0},codemirror(){var e;return(e=this.$refs.cmEditor)==null?void 0:e.codemirror},filterData(){this.key.content||(this.key.content=[]);const e=this.searchInput,t=this.key.content.filter(s=>!e||(s.value?s.value.includes(e):s.includes(e)));return this.dataCount=this.key.count??t.length,t},dialogTitle(){const e=this.itemModel.old;switch(this.key.type){case"hash":return e?"Edit Hash":"Add to hash";case"set":return e?"Edit Set":"Add to set";case"zset":return e?"Edit ZSet":"Add to zset";case"list":return e?"Edit List":"Add to list"}return""},dynamicHeight(){return window.innerHeight-100+"px"}},mounted(){const e=()=>{const t=this.$refs.panel,s=this.$refs.stringPanel,d=this.$refs.listPanel,i=((t==null?void 0:t.clientHeight)||0)+((s==null?void 0:s.clientHeight)||0)+((d==null?void 0:d.clientHeight)||0)+16;this.remainHeight=window.innerHeight-i};e(),new ResizeObserver(e).observe(document.body),window.addEventListener("resize",e),this.on("new",({prefix:t})=>{this.isNew=!0,this.keyLoading=!1,this.language.current="Text",this.key={name:t,type:z.STRING,ttl:-1},this.edit=this.deepClone(this.key)}).on("detail",t=>{this.isNew=!1,this.keyLoading=!1,this.pageIndex=t.page.pageNum,this.pageSize=t.page.pageSize,this.itemDialogVisiable=!1,this.key=t.res,this.edit=this.deepClone(t.res),this.autoDetect()}).on("pagination",t=>{this.key.content=t}).on("msg",t=>{q(t)}).on("error",t=>{C(t)}).on("success",t=>{j({showClose:!0,duration:1500,message:t,type:"success"}),this.itemDetail.visible=!1}).on("refresh",()=>{this.refresh()}),this.emit("init"),window.addEventListener("keydown",t=>{t.key=="Escape"&&(this.itemDetail.visible=!1),U(t)&&t.code=="KeyS"&&["string","ReJSON-RL"].includes(this.key.type)&&this.update()})},methods:{prettyBytes:ye,changePage(e,t){this.emit("changePage",t?e:this.pageIndex+e)},autoDetect(){if(!["string","ReJSON-RL"].includes(this.key.type))return this.cmContent=this.edit.content;const e=this.edit.content,t=(e==null?void 0:e.match(/^\s*[{[]/))!=null;this.language.current=t?"JSON":"Text",t?this.setJSONContent(e):this.cmContent=e},setJSONContent(e){var t;try{this.cmContent=W(X((t=e==null?void 0:e.replace)==null?void 0:t.call(e,/Â /g," ")),null,2);return}catch(s){console.log(s)}this.cmContent=e},refresh(){this.itemDialogVisiable=!1,this.emit("refresh",{key:this.key})},saveItem(){if(!this.edit.name)return C("Key name cannot be null!");this.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})},showOpenDialog(){this.itemModel={},this.itemDialogVisiable=!0},showEditDialog(e){this.itemModel={...e,old:{...e}},this.itemDialogVisiable=!0},showDetailDialog(e){this.itemModel={...e,old:{...e}},this.itemDetail.visible=!0,this.itemDetail.content=e.value},saveValue(e){this.itemModel.value=e,this.saveItem()},deleteLine(e){V(this.$t("confirm.deleteRedisKey")).then(()=>{this.emit("deleteLine",e)})},deleteKey(){V(this.$t("confirm.deleteRedisKey")).then(()=>{this.emit("del",{key:{name:this.key.name}}),this.key={},this.edit={}})},rename(){console.log(this.key.name),this.emit("rename",{key:{name:this.key.name,newName:this.edit.name}})},ttlKey(){this.emit("ttl",{key:{name:this.key.name,ttl:this.edit.ttl}})},update(){if(!this.edit.name)return C("Key name cannot be null!");this.emit("update",{key:{name:this.key.name,newName:this.edit.name,type:this.key.type,ttl:this.edit.ttl,content:this.cmContent}})},deepClone(e){let t=Array.isArray(e)?[]:{};if(e&&typeof e=="object")for(let s in e)e.hasOwnProperty(s)&&(e[s]&&typeof e[s]=="object"?t[s]=this.deepClone(e[s]):t[s]=e[s]);return t}}},ge=e=>(Y("data-v-f80bf4ca"),e=e(),G(),e),fe={class:"redis-view-container"},ke={key:0,style:{"text-align":"center"}},be={key:1,class:"key-tab-container"},ve={ref:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},_e={key:1,class:"key-detail-type"},we=ge(()=>y("span",null,"TTL",-1)),Se={key:0,ref:"stringPanel",class:"flex pr-4 mb-2 gap-x-7"},Ce={key:0},xe={class:"value-panel"},De={key:1},Ve={ref:"listPanel"},Ee={class:"ml-2 inline-block"},ze=["title","textContent"];function Ne(e,t,s,d,i,o){const h=ie,_=te,p=le,m=S("vsc-button"),N=S("codemirror"),x=ne,I=oe,T=ee,w=se,M=ae,f=me,L=re,B=S("DetailDialog");return r(),g("div",fe,[i.keyLoading?(r(),g("div",ke," loading ")):(r(),g("div",be,[y("div",ve,[y("div",null,[n(p,{ref:"keyNameInput",modelValue:i.edit.name,"onUpdate:modelValue":t[1]||(t[1]=l=>i.edit.name=l),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:D(o.rename,["enter"])},{prepend:a(()=>[i.isNew?(r(),c(_,{key:0,modelValue:i.key.type,"onUpdate:modelValue":t[0]||(t[0]=l=>i.key.type=l),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:a(()=>[n(h,{value:"string",label:"STRING"}),n(h,{value:"list",label:"LIST"}),n(h,{value:"set",label:"SET"}),n(h,{value:"zset",label:"ZSET"}),n(h,{value:"hash",label:"HASH"}),n(h,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(r(),g("span",_e,v(i.key.type),1))]),_:1},8,["modelValue","onKeyup"]),i.isNew?u("",!0):(r(),c(m,{key:0,class:"inline btn-ad",size:"medium",icon:"el-icon-check",onClick:o.rename},null,8,["onClick"]))]),y("div",null,[n(p,{modelValue:i.edit.ttl,"onUpdate:modelValue":t[2]||(t[2]=l=>i.edit.ttl=l),type:"number",size:"small",style:{width:"220px"},onKeyup:D(o.ttlKey,["enter"])},{prepend:a(()=>[we]),_:1},8,["modelValue","onKeyup"]),n(m,{class:"inline btn-ad",size:"medium",icon:"el-icon-check",onClick:o.ttlKey},null,8,["onClick"]),n(m,{class:"inline btn-ad",size:"medium",icon:"el-icon-delete",onClick:o.deleteKey},{default:a(()=>[k("Delete")]),_:1},8,["onClick"]),n(m,{class:"inline btn-ad",size:"medium",icon:"el-icon-refresh",onClick:o.refresh},{default:a(()=>[k("Refresh")]),_:1},8,["onClick"])])],512),["string","ReJSON-RL"].includes(i.key.type)?(r(),g("div",Se,[y("div",null," Size: "+v(o.prettyBytes(o.size)),1),["string","ReJSON-RL"].includes(i.key.type)?(r(),g("div",Ce,[n(_,{modelValue:i.language.current,"onUpdate:modelValue":t[3]||(t[3]=l=>i.language.current=l),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:a(()=>[(r(!0),g(A,null,J(i.language.supports,l=>(r(),c(h,{key:l,value:l},{default:a(()=>[k(v(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(m,{class:"inline btn-ad",style:{height:"27px"},onClick:o.update},{default:a(()=>[k("Save")]),_:1},8,["onClick"])])):u("",!0)],512)):u("",!0),K(n(x,null,{default:a(()=>[y("div",xe,[n(N,{ref:"cmEditor",value:i.cmContent,"onUpdate:value":t[4]||(t[4]=l=>i.cmContent=l),language:i.language.current,class:"json-panel",style:F("height:"+i.remainHeight+"px")},null,8,["value","language","style"])])]),_:1},512),[[R,["string","ReJSON-RL"].includes(i.key.type)]]),i.key.type=="list"||i.key.type=="set"||i.key.type=="zset"||i.key.type=="hash"||i.key.type=="stream"?(r(),g("div",De,[y("div",Ve,[n(p,{modelValue:i.searchInput,"onUpdate:modelValue":t[5]||(t[5]=l=>i.searchInput=l),class:"filter-input mb-2",size:"small",placeholder:e.$t("result.searchNotice"),style:{width:"200px"},clearable:!0},null,8,["modelValue","placeholder"]),n(I,{class:"item",effect:"dark",content:"Add new key",placement:"bottom-start"},{default:a(()=>[y("div",Ee,[i.key.type!="stream"?(r(),c(m,{key:0,type:"icon",icon:"codicon-add text-lg",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:t[6]||(t[6]=l=>o.showOpenDialog())})):u("",!0)])]),_:1}),n(T,{"page-size":i.pageSize,"onUpdate:pageSize":t[7]||(t[7]=l=>i.pageSize=l),"current-page":i.pageIndex,"onUpdate:currentPage":t[8]||(t[8]=l=>i.pageIndex=l),small:!0,total:i.dataCount,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:t[9]||(t[9]=l=>o.changePage(l,!0)),onNextClick:t[10]||(t[10]=()=>o.changePage(1)),onPrevClick:t[11]||(t[11]=()=>o.changePage(-1))},null,8,["page-size","current-page","total"]),n(M,{modelValue:i.itemDialogVisiable,"onUpdate:modelValue":t[16]||(t[16]=l=>i.itemDialogVisiable=l),title:o.dialogTitle,closeOnClickModal:!1,width:"30%",class:"new-item-dialog"},{footer:a(()=>[n(m,{type:"secondary",onClick:t[15]||(t[15]=l=>i.itemDialogVisiable=!1)},{default:a(()=>[k(v(e.$t("common.cancel")),1)]),_:1}),n(m,{type:"primary",onClick:o.saveItem},{default:a(()=>[k("Confirm")]),_:1},8,["onClick"])]),default:a(()=>[n(x,{"label-width":"60px"},{default:a(()=>[i.key.type=="hash"?(r(),c(w,{key:0,label:"key"},{default:a(()=>[n(p,{modelValue:i.itemModel.key,"onUpdate:modelValue":t[12]||(t[12]=l=>i.itemModel.key=l),size:"small"},null,8,["modelValue"])]),_:1})):u("",!0),i.key.type=="zset"?(r(),c(w,{key:1,label:"score"},{default:a(()=>[n(p,{modelValue:i.itemModel.score,"onUpdate:modelValue":t[13]||(t[13]=l=>i.itemModel.score=l),size:"small"},null,8,["modelValue"])]),_:1})):u("",!0),n(w,{label:"value"},{default:a(()=>[n(p,{modelValue:i.itemModel.value,"onUpdate:modelValue":t[14]||(t[14]=l=>i.itemModel.value=l),size:"small"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])],512),y("div",null,[n(L,{data:o.filterData,height:i.remainHeight},{default:a(()=>[n(f,{type:"index",label:"Index",sortable:"",width:"80",align:"center"}),i.key.type=="hash"?(r(),c(f,{key:0,"sort-by":"key",resizable:"",sortable:"",label:"Key",align:"center",width:"200",prop:"key"})):u("",!0),i.key.type=="zset"?(r(),c(f,{key:1,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):u("",!0),i.key.type=="stream"?(r(),c(f,{key:2,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):u("",!0),n(f,{"sort-by":"value",resizable:"",sortable:"",label:"Value",align:"center"},{default:a(l=>{var b;return[y("span",{class:"item-value",title:l.row.value,textContent:v(((b=l.row)==null?void 0:b.value)||l.row)},null,8,ze)]}),_:1}),n(f,{label:"Operation",width:"150",align:"center"},{default:a(l=>[["hash","set","zset","stream"].includes(i.key.type)?(r(),c(m,{key:0,type:"icon",icon:"codicon-zoom-in",title:"View On Dialog",onClick:b=>{o.showDetailDialog(l.row)}},null,8,["onClick"])):u("",!0),["hash","set","zset"].includes(i.key.type)?(r(),c(m,{key:1,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:b=>o.showEditDialog(l.row)},null,8,["onClick"])):u("",!0),n(m,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:b=>o.deleteLine(l.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):u("",!0)])),n(B,{onChange:o.saveValue},null,8,["onChange"])])}const it=O(pe,[["render",Ne],["__scopeId","data-v-f80bf4ca"]]);export{it as default};
