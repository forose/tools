import{_ as M,h as R,j as H,af as J,a as p,b as c,e as n,w as o,I as V,l as d,f as m,t as v,D as K,E as A,k as w,o as r,q as k,F as P,y as U,C as B,z as F,A as G}from"./app-Bf1EJw8l.js";import{c as Y}from"./codemirror-my-f36oj.js";import{s as Z,e as C,n as W}from"./notify-7ms8YXRV.js";import{D as q,s as j,p as Q,d as X,E as $}from"./DetailDialog-sv5oPYn6.js";import{E as z}from"./index-B_FZe6hO.js";import{a as ee,E as te}from"./index-I4QpTbxY.js";import{E as le}from"./index-87euUeSH.js";import{a as ie,E as ne}from"./index-DGGgE9Vn.js";import{E as se}from"./index-Ds0zupmL.js";import{E as oe}from"./index-C6Zovpry.js";import{a as ae,E as re}from"./index-j61gtqiN.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./DatabaseType-LnCwhqHG.js";import"./index-Dpstq9UH.js";import"./icon-CZcOhJQp.js";import"./use-global-config-0XpG2_0j.js";import"./index-CFJCZjdX.js";import"./focus-trap-DLD2w1Ia.js";import"./index-CslgC0gF.js";import"./use-form-item-DdyI_hvh.js";import"./aria-46nDEFyt.js";import"./validator-Di5JEBAH.js";import"./index-CXFq46JV.js";import"./index-D_NJ2QbA.js";import"./scroll-DzYU1O0r.js";import"./_baseIteratee-xh2dZROY.js";import"./_baseClone-DEWKTuY-.js";import"./_initCloneObject-DbrZpPYH.js";import"./flatten-BCYDgirk.js";import"./index-BtYaA7w7.js";import"./isArrayLikeObject-DnFfw4hg.js";var D=(t=>(t.STRING="string",t.REJSON="ReJSON-RL",t.HASH="hash",t.LIST="list",t.ZSET="zset",t.SET="set",t.STREAM="stream",t))(D||{});const me={components:{codemirror:Y,DetailDialog:q},mixins:[R],data(){return{cmOptions:{mode:"text/plain",foldGutter:!0,gutters:["CodeMirror-foldgutter"],foldOptions:void 0},cmContent:"",language:{current:"Text",supports:["Text","JSON","Yaml"],map:{Text:"text/plain",JSON:"application/json",Yaml:"text/yaml"}},itemModel:{old:null,key:null,score:null,value:null},searchInput:"",pageIndex:1,pageSize:100,dataCount:0,remainHeight:0,keyLoading:!0,isNew:!1,key:{name:"",ttl:-1,content:null,count:null,type:null},edit:{name:"",ttl:-1,content:null},itemDialogVisiable:!1,selectStyle:{float:this.float},textrows:6}},computed:{...H(X,{itemDetail:t=>t.detail}),size(){var t;return((t=this.cmContent)==null?void 0:t.length)||0},codemirror(){var t;return(t=this.$refs.cmEditor)==null?void 0:t.codemirror},isJSON(){var t;return["string","ReJSON-RL"].includes(this.key.type)&&((t=this.edit.content)==null?void 0:t.match(/^\s*[{[]/))!=null},filterData(){this.key.content||(this.key.content=[]);const t=this.searchInput,e=this.key.content.filter(s=>!t||(s.value?s.value.includes(t):s.includes(t)));return this.dataCount=this.key.count??e.length,e},dialogTitle(){const t=this.itemModel.old;switch(this.key.type){case"hash":return t?"Edit Hash":"Add to hash";case"set":return t?"Edit Set":"Add to set";case"zset":return t?"Edit ZSet":"Add to zset";case"list":return t?"Edit List":"Add to list"}return""},dynamicHeight(){return window.innerHeight-100+"px"}},mounted(){const t=()=>{const e=this.$refs.panel,s=this.$refs.stringPanel,b=this.$refs.listPanel,l=((e==null?void 0:e.clientHeight)||0)+((s==null?void 0:s.clientHeight)||0)+((b==null?void 0:b.clientHeight)||0)+16;this.remainHeight=window.innerHeight-l};t(),new ResizeObserver(t).observe(document.body),window.addEventListener("resize",t),this.on("new",({prefix:e})=>{this.isNew=!0,this.keyLoading=!1,this.language.current="Text",this.key={name:e,type:D.STRING,ttl:-1},this.edit=this.deepClone(this.key)}).on("detail",e=>{this.isNew=!1,this.keyLoading=!1,this.language.current="Text",this.pageIndex=e.page.pageNum,this.pageSize=e.page.pageSize,this.itemDialogVisiable=!1,this.key=e.res,this.edit=this.deepClone(e.res),["string","ReJSON-RL"].includes(this.key.type)&&(this.cmContent=this.edit.content),this.autoDetect()}).on("pagination",e=>{this.key.content=e}).on("msg",e=>{Z(e)}).on("error",e=>{C(e)}).on("success",e=>{W({showClose:!0,duration:1500,message:e,type:"success"}),this.itemDetail.visible=!1}).on("refresh",()=>{this.refresh()}),this.emit("init"),window.addEventListener("keydown",e=>{e.key=="Escape"&&(this.itemDetail.visible=!1),J(e)&&e.code=="KeyS"&&["string","ReJSON-RL"].includes(this.key.type)&&this.update()})},methods:{changePage(t,e){this.emit("changePage",e?t:this.pageIndex+t)},autoDetect(){!this.key||!["string","ReJSON-RL"].includes(this.key.type)||this.$nextTick(()=>{this.isJSON?(this.language.current="JSON",this.format("JSON")):this.language.current="Text"})},format(t){var e;if(t=="JSON")try{const s=this.cmContent;this.cmContent=j(Q((e=s==null?void 0:s.replace)==null?void 0:e.call(s,/Â /g," ")),null,2)}catch(s){console.log(s)}},refresh(){this.itemDialogVisiable=!1,this.emit("refresh",{key:this.key})},saveItem(){if(!this.edit.name)return C("Key name cannot be null!");this.emit("saveItem",{...this.itemModel,keyName:this.edit.name,type:this.key.type})},showOpenDialog(){this.itemModel={},this.itemDialogVisiable=!0},showEditDialog(t){this.itemModel={...t,old:{...t}},this.itemDialogVisiable=!0},showDetailDialog(t){this.itemModel={...t,old:{...t}},this.itemDetail.visible=!0,this.itemDetail.content=t.value},saveValue(t){this.itemModel.value=t,this.saveItem()},deleteLine(t){z.confirm("Are you sure to delete this key?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.emit("deleteLine",t)})},deleteKey(){z.confirm("Are you sure to delete this key?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.emit("del",{key:{name:this.key.name}}),this.key={},this.edit={}})},rename(){console.log(this.key.name),this.emit("rename",{key:{name:this.key.name,newName:this.edit.name}})},ttlKey(){this.emit("ttl",{key:{name:this.key.name,ttl:this.edit.ttl}})},update(){if(!this.edit.name)return C("Key name cannot be null!");this.emit("update",{key:{name:this.key.name,newName:this.edit.name,type:this.key.type,ttl:this.edit.ttl,content:this.cmContent}})},deepClone(t){let e=Array.isArray(t)?[]:{};if(t&&typeof t=="object")for(let s in t)t.hasOwnProperty(s)&&(t[s]&&typeof t[s]=="object"?e[s]=this.deepClone(t[s]):e[s]=t[s]);return e}}},ue=t=>(F("data-v-905ae4bf"),t=t(),G(),t),de={class:"redis-view-container"},ce={key:0,style:{"text-align":"center"}},pe={key:1,class:"key-tab-container"},he={ref:"panel",class:"flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3"},ye={key:1,class:"key-detail-type"},ge=ue(()=>c("span",null,"TTL",-1)),ke={key:0,ref:"stringPanel",class:"flex pr-4 mb-2 gap-x-7"},fe={key:0},ve={class:"value-panel"},be={key:1},_e={ref:"listPanel"},we={class:"ml-2 inline-block"},Ce=["title","textContent"];function Se(t,e,s,b,l,a){const h=te,S=ee,y=le,u=w("vsc-button"),E=w("codemirror"),x=ie,N=se,O=$,_=ne,I=oe,g=re,T=ae,L=w("DetailDialog");return r(),p("div",de,[l.keyLoading?(r(),p("div",ce," loading ")):(r(),p("div",pe,[c("div",he,[c("div",null,[n(y,{ref:"keyNameInput",modelValue:l.edit.name,"onUpdate:modelValue":e[1]||(e[1]=i=>l.edit.name=i),size:"small",placeholder:"Please input key name",style:{width:"500px"},onKeyup:V(a.rename,["enter"])},{prepend:o(()=>[l.isNew?(r(),d(S,{key:0,modelValue:l.key.type,"onUpdate:modelValue":e[0]||(e[0]=i=>l.key.type=i),placeholder:"Forever",size:"small",style:{width:"100px"}},{default:o(()=>[n(h,{value:"string",label:"STRING"}),n(h,{value:"list",label:"LIST"}),n(h,{value:"set",label:"SET"}),n(h,{value:"zset",label:"ZSET"}),n(h,{value:"hash",label:"HASH"}),n(h,{value:"stream",label:"STREAM"})]),_:1},8,["modelValue"])):(r(),p("span",ye,v(l.key.type),1))]),_:1},8,["modelValue","onKeyup"]),l.isNew?m("",!0):(r(),d(u,{key:0,class:"inline btn-ad",size:"medium",icon:"el-icon-check",onClick:a.rename},null,8,["onClick"]))]),c("div",null,[n(y,{modelValue:l.edit.ttl,"onUpdate:modelValue":e[2]||(e[2]=i=>l.edit.ttl=i),type:"number",size:"small",style:{width:"220px"},onKeyup:V(a.ttlKey,["enter"])},{prepend:o(()=>[ge]),_:1},8,["modelValue","onKeyup"]),n(u,{class:"inline btn-ad",size:"medium",icon:"el-icon-check",onClick:a.ttlKey},null,8,["onClick"]),n(u,{class:"inline btn-ad",size:"medium",icon:"el-icon-delete",onClick:a.deleteKey},{default:o(()=>[k("Delete")]),_:1},8,["onClick"]),n(u,{class:"inline btn-ad",size:"medium",icon:"el-icon-refresh",onClick:a.refresh},{default:o(()=>[k("Refresh")]),_:1},8,["onClick"])])],512),["string","ReJSON-RL"].includes(l.key.type)?(r(),p("div",ke,[c("div",null," Size: "+v(a.size)+" Bytes ",1),["string","ReJSON-RL"].includes(l.key.type)?(r(),p("div",fe,[n(S,{modelValue:l.language.current,"onUpdate:modelValue":e[3]||(e[3]=i=>l.language.current=i),placeholder:"Default",size:"small",style:{width:"145px"},class:"mr-2"},{default:o(()=>[(r(!0),p(P,null,U(l.language.supports,i=>(r(),d(h,{key:i,value:i},{default:o(()=>[k(v(i),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(u,{class:"inline btn-ad",style:{height:"27px"},onClick:a.update},{default:o(()=>[k("Save")]),_:1},8,["onClick"])])):m("",!0)],512)):m("",!0),K(n(x,null,{default:o(()=>[c("div",ve,[n(E,{ref:"cmEditor",value:l.cmContent,"onUpdate:value":e[4]||(e[4]=i=>l.cmContent=i),options:l.cmOptions,language:l.language.current,class:"json-panel",style:B("height:"+l.remainHeight+"px")},null,8,["value","options","language","style"])])]),_:1},512),[[A,["string","ReJSON-RL"].includes(l.key.type)]]),l.key.type=="list"||l.key.type=="set"||l.key.type=="zset"||l.key.type=="hash"||l.key.type=="stream"?(r(),p("div",be,[c("div",_e,[n(y,{modelValue:l.searchInput,"onUpdate:modelValue":e[5]||(e[5]=i=>l.searchInput=i),class:"filter-input mb-2",size:"small",placeholder:t.$t("result.searchNotice"),style:{width:"200px"},clearable:!0},null,8,["modelValue","placeholder"]),n(N,{class:"item",effect:"dark",content:"Add new key",placement:"bottom-start"},{default:o(()=>[c("div",we,[l.key.type!="stream"?(r(),d(u,{key:0,type:"icon",icon:"codicon-add text-lg",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:e[6]||(e[6]=i=>a.showOpenDialog())})):m("",!0)])]),_:1}),n(O,{"page-size":l.pageSize,"onUpdate:pageSize":e[7]||(e[7]=i=>l.pageSize=i),"current-page":l.pageIndex,"onUpdate:currentPage":e[8]||(e[8]=i=>l.pageIndex=i),small:!0,total:l.dataCount,"page-sizes":[20,50,100,200,300],layout:"prev,pager, next, total",onCurrentChange:e[9]||(e[9]=i=>a.changePage(i,!0)),onNextClick:e[10]||(e[10]=()=>a.changePage(1)),onPrevClick:e[11]||(e[11]=()=>a.changePage(-1))},null,8,["page-size","current-page","total"]),n(I,{modelValue:l.itemDialogVisiable,"onUpdate:modelValue":e[16]||(e[16]=i=>l.itemDialogVisiable=i),title:a.dialogTitle,closeOnClickModal:!1,width:"30%",class:"new-item-dialog"},{footer:o(()=>[n(u,{type:"secondary",onClick:e[15]||(e[15]=i=>l.itemDialogVisiable=!1)},{default:o(()=>[k(v(t.$t("common.cancel")),1)]),_:1}),n(u,{type:"primary",onClick:a.saveItem},{default:o(()=>[k("Confirm")]),_:1},8,["onClick"])]),default:o(()=>[n(x,{"label-width":"60px"},{default:o(()=>[l.key.type=="hash"?(r(),d(_,{key:0,label:"key"},{default:o(()=>[n(y,{modelValue:l.itemModel.key,"onUpdate:modelValue":e[12]||(e[12]=i=>l.itemModel.key=i),size:"small"},null,8,["modelValue"])]),_:1})):m("",!0),l.key.type=="zset"?(r(),d(_,{key:1,label:"score"},{default:o(()=>[n(y,{modelValue:l.itemModel.score,"onUpdate:modelValue":e[13]||(e[13]=i=>l.itemModel.score=i),size:"small"},null,8,["modelValue"])]),_:1})):m("",!0),n(_,{label:"value"},{default:o(()=>[n(y,{modelValue:l.itemModel.value,"onUpdate:modelValue":e[14]||(e[14]=i=>l.itemModel.value=i),size:"small"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])],512),c("div",null,[n(T,{data:a.filterData,height:l.remainHeight},{default:o(()=>[n(g,{type:"index",label:"Index",sortable:"",width:"80",align:"center"}),l.key.type=="hash"?(r(),d(g,{key:0,"sort-by":"key",resizable:"",sortable:"",label:"Key",align:"center",width:"200",prop:"key"})):m("",!0),l.key.type=="zset"?(r(),d(g,{key:1,"sort-by":"score",resizable:"",sortable:"",label:"Score",align:"center",width:"200",prop:"score"})):m("",!0),l.key.type=="stream"?(r(),d(g,{key:2,"sort-by":"id",resizable:"",sortable:"",label:"id",align:"center",width:"200",prop:"id"})):m("",!0),n(g,{"sort-by":"value",resizable:"",sortable:"",label:"Value",align:"center"},{default:o(i=>{var f;return[c("span",{class:"item-value",title:i.row.value,textContent:v(((f=i.row)==null?void 0:f.value)||i.row)},null,8,Ce)]}),_:1}),n(g,{label:"Operation",width:"150",align:"center"},{default:o(i=>[["hash","set","zset","stream"].includes(l.key.type)?(r(),d(u,{key:0,type:"icon",icon:"codicon-zoom-in",title:"View On Dialog",onClick:f=>{a.showDetailDialog(i.row)}},null,8,["onClick"])):m("",!0),["hash","set","zset"].includes(l.key.type)?(r(),d(u,{key:1,type:"icon",icon:"codicon-edit text-base",title:"edit",style:{color:"var(--vscode-terminal-ansiYellow)"},onClick:f=>a.showEditDialog(i.row)},null,8,["onClick"])):m("",!0),n(u,{class:"ml-3",type:"icon",icon:"el-icon-delete text-base",style:{color:"#f56c6c"},title:"delete",onClick:f=>a.deleteLine(i.row)},null,8,["onClick"])]),_:1})]),_:1},8,["data","height"])])])):m("",!0)])),n(L,{onChange:a.saveValue},null,8,["onChange"])])}const lt=M(me,[["render",Se],["__scopeId","data-v-905ae4bf"]]);export{lt as default};
